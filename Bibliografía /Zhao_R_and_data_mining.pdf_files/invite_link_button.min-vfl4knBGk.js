define(["require","exports","tslib","react","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/snackbar","dig-components/tooltips","file-transfers/common/helpers","modules/clean/growth/smb_funnel/smb_funnel_logger","modules/clean/react/css","modules/clean/react/admin/teams/onboarding/web/util/invite_common","modules/core/exception","modules/core/i18n"],(function(e,t,n,i,o,s,r,a,c,l,u,h,p,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i);var m=(function(e){function t(t){var o=e.call(this,t)||this;return o.buttonRef=i.default.createRef(),o.copyLink=function(e){try{l.copyToClipboard(e),o.showMessage(f.intl.formatMessage({defaultMessage:"Link copied!",description:"Notification text when copying link to clipboard is successful"})),o.props.onLinkCopied&&o.props.onLinkCopied()}catch(e){o.showMessage(f.intl.formatMessage({defaultMessage:"Failed to copy invite link.",description:"Notification text when copying invite link to clipboard has failed"})),d.reportStack("Copy to clipboard failed: "+e.message,{tags:["MobileWebInvites"]})}},o.createInviteLink=function(){return n.__awaiter(o,void 0,Promise,(function(){var e,t,i,o,s,r,a,c;return n.__generator(this,(function(n){switch(n.label){case 0:e=this.props,t=e.userId,i=e.linkExpiration,o=void 0===i?2592e3:i,u.SMBFunnelLogger.log("invite_link_create_attempt"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,p.createInviteLink(t,o)];case 2:return s=n.sent(),r=s.invite_link_url,a=s.invite_token,u.SMBFunnelLogger.log("invite_link_create_success"),this.inviteToken=a,[2,r];case 3:throw c=n.sent(),u.SMBFunnelLogger.log("invite_link_create_error",{error:null==c?void 0:c.error[".tag"]}),c;case 4:return[2]}}))}))},o.destroyLinkIfUnused=function(){!o.state.isInviteLinkUsed&&o.inviteToken&&p.deleteInviteLink(o.props.userId,o.inviteToken).catch((function(){}))},o.handleClick=function(){return n.__awaiter(o,void 0,void 0,(function(){var e,t,i,o,s,r,a,c,l=this;return n.__generator(this,(function(n){switch(n.label){case 0:e=this.props,t=e.onClick,i=void 0===t?function(){}:t,o=e.onShareAction,s=void 0===o?function(){}:o,r=e.onShareDismiss,a=void 0===r?function(){}:r,i(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.createInviteLinkPromise];case 2:return c=n.sent(),void 0!==navigator.share?navigator.share({url:c}).then((function(){return s()})).catch((function(e){"AbortError"!==e.name?l.copyLink(c):a()})):this.copyLink(c),[3,4];case 3:return n.sent(),this.showMessage(f.intl.formatMessage({defaultMessage:"Failed to create invite link.",description:'Nofication text when failing to create invite link after user click "Share invite link" button'})),[3,4];case 4:return[2]}}))}))},o.hideMessage=function(){o.setState({message:"",showSnackbar:!1,showTooltip:!1})},o.showMessage=function(e){void 0===e&&(e=""),e&&o.setState({message:e,showSnackbar:o.useSnackbar,showTooltip:o.useTooltip})},o.state={isInviteLinkUsed:!1,message:"",showSnackbar:!1,showTooltip:!1},o}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.createInviteLinkPromise=this.createInviteLink(),this.useTooltip&&this.buttonRef.current&&(this.buttonRef.current.addEventListener("mouseleave",this.hideMessage),this.buttonRef.current.addEventListener("blur",this.hideMessage))},t.prototype.componentWillUnmount=function(){this.destroyLinkIfUnused(),this.useTooltip&&this.buttonRef.current&&(this.buttonRef.current.removeEventListener("mouseleave",this.hideMessage),this.buttonRef.current.removeEventListener("blur",this.hideMessage))},t.prototype.render=function(){var e=this.props,t=e.buttonClass,n=void 0===t?"":t,l=e.children,u=this.state,h=u.message,p=u.showTooltip,d=u.showSnackbar;return i.default.createElement("div",{className:"invite-link-btn"},i.default.createElement(o.Button,{className:n,variant:"outline",size:"large",onClick:this.handleClick,ref:this.buttonRef},i.default.createElement(s.UIIcon,{src:r.LinkLine}),l||f.intl.formatMessage({defaultMessage:"Share invite link",description:"A button that will create an URL that user can share with another person to invite them to the team."})),this.useSnackbar&&i.default.createElement(a.Snackbar,{className:"invite-link-btn__snackbar",open:d,onRequestClose:this.hideMessage},i.default.createElement(a.Snackbar.Message,null,h)),this.useTooltip&&i.default.createElement(c.Tooltip.Control,{triggerRef:this.buttonRef,open:p,auto:!0,placement:"top"},h))},Object.defineProperty(t.prototype,"useTooltip",{get:function(){return"tooltip"===this.props.notifyWith},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useSnackbar",{get:function(){return"snackbar"===this.props.notifyWith},enumerable:!0,configurable:!0}),t})(i.default.Component);t.InviteLinkButtonView=m,t.InviteLinkButton=h.requireCssWithComponent(m,["/static/css/admin/teams/essential_setup/invite_link_button-vflo9hqDl.css"])}));
//# sourceMappingURL=invite_link_button.min.js-vflEYCk1z.map