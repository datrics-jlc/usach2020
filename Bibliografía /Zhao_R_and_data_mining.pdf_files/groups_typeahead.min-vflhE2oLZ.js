define(["require","exports","tslib","react","modules/core/i18n","modules/clean/viewer","spectrum/typeahead","dig-components/icons/src","dig-components/typography","dig-components/icons","dig-components/avatar","modules/clean/api_v2/default_team_client","modules/clean/react/css","modules/clean/teams/admin/widgets/groups/create_group_modal"],(function(e,t,r,n,o,a,u,i,s,c,l,g,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n);var d={group_name:o.intl.formatMessage({defaultMessage:"Create new group"}),group_id:"",group_management_type:{".tag":"other"}},f=function(e){var t=e.toUpperCase().split(" ");return""+t[0][0]+(t.length>1?t[t.length-1][0]:"")},_=function(e){var t=e.token,r=e.query;return t===d?n.default.createElement(n.default.Fragment,null,n.default.createElement(c.UIIcon,{className:"group-suggestion-icon",src:i.AddCircleFill}),n.default.createElement(s.Text,null,r?o.intl.formatMessage({defaultMessage:'Create "{group_name}"'},{group_name:r}):t.group_name)):n.default.createElement(n.default.Fragment,null,n.default.createElement("div",{className:"group-suggestion-icon"},n.default.createElement(l.Avatar,{size:"small",hasNoOutline:!0,backgroundColor:l.avatarColorForUserIdentifier(f(t.group_name))},f(t.group_name))),n.default.createElement("div",{className:"group-suggestion-info"},n.default.createElement(s.Text,null,t.group_name),n.default.createElement(s.Text,{size:"small",color:"faint"},o.intl.formatMessage({defaultMessage:"{count, plural, one{# member} other{# members}}",description:"Number of members in a group"},{count:t.member_count||0}))))};t.fetchGroups=function(e){return void 0===e&&(e=!0),r.__awaiter(void 0,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,new g.DefaultTeamApiV2Client(a.Viewer.get_viewer().work_user).ns("team").rpc("groups/list",{limit:1e3},{}).then((function(t){if(!e)return t.groups;var r=t.groups.reduce((function(e,t){return"system_managed"===t.group_management_type[".tag"]&&(t.member_count||0)>=(e.member_count||0)?t:e})).group_id;return t.groups.filter((function(e){return e.group_id!==r}))}))];case 1:return[2,t.sent()]}}))}))},t.groupExists=function(e,t){return e.some((function(e){return e.group_name.toLocaleLowerCase()===t.toLocaleLowerCase()}))},t.GroupsTypeahead=p.requireCssWithComponent((function(e){var a=e.selected,i=e.groups,s=void 0===i?[]:i,c=e.onChange,l=e.onCreate,g=e.onInputChange,p=e.handleCreateModal,f=n.useState(!1),v=f[0],h=f[1],y=n.useState(),C=y[0],E=y[1],w=n.useState([]),b=w[0],x=w[1];n.useEffect((function(){return null==p?void 0:p(v)}),[v]),n.useEffect((function(){return null==g?void 0:g(C)}),[C]),n.useEffect((function(){return M()}),[a,s]);var M=function(e){E(e),x(r.__spreadArrays([d],s.reduce((function(t,r){return a.find((function(e){return e.group_id===r.group_id}))?t:(e?r.group_name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1&&t.push(r):t.push(r),t)}),[]).sort((function(e,t){return e.group_name.localeCompare(t.group_name)}))))};return n.default.createElement(u.Typeahead,{height:200,listItemHeight:48,className:"groups-typeahead",inputProps:{placeholder:a.length?void 0:o.intl.formatMessage({defaultMessage:"Select or create group"})},onChange:M,onRemoveToken:function(e){return c(a.filter((function(t){return t.group_id!==e.group_id})))},onSelect:function(e,n,o){if(e===d){if(!o)return void h(!0);t.groupExists(s,o)||m.createGroup(o).then((function(e){var t={group_id:e.group_id,group_name:e.group_name,group_external_id:e.group_external_id,group_management_type:e.group_management_type,member_count:e.member_count};null==l||l(t)})).catch((function(e){return(function(e){c(r.__spreadArrays(a,[{group_name:e,group_id:e+"-invalid",group_management_type:{".tag":"other"},variant:"error"}])),E(void 0)})(o)})),E(void 0)}var u=s.find((function(t){return t.group_id===e.group_id}));u&&c(r.__spreadArrays(a,[u]))},renderSuggestion:function(e){return n.default.createElement(_,{token:e,query:C})},renderTokenContent:function(e){return n.default.createElement(n.default.Fragment,null,e.group_name)},suggestions:b,tokens:a.map((function(e){return{key:e.group_id,variant:e.variant||"default",content:e}}))})}),["/static/css/spectrum/index.web-vfl_-DzRS.css","/static/css/dig-components/index.web-vflAfUkoe.css","/static/css/teams/admin/widgets/groups/groups_typeahead-vfli8OYdu.css"])}));
//# sourceMappingURL=groups_typeahead.min.js-vfl8Oa0dX.map